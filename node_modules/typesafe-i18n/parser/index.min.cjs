"use strict";var u=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var D=(r,t)=>{for(var e in t)u(r,e,{get:t[e],enumerable:!0})},M=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of F(t))!v.call(r,o)&&o!==e&&u(r,o,{get:()=>t[o],enumerable:!(s=b(t,o))||s.enumerable});return r};var j=r=>M(u({},"__esModule",{value:!0}),r);var Q={};D(Q,{experimentalParseMessage:()=>B,experimentalSerializeMessage:()=>k});module.exports=j(Q);var c=r=>r!==void 0;var f=r=>typeof r=="string";var y=r=>t=>t[r];var x=r=>Array.from(new Set(r));var O=r=>Object.fromEntries(Object.entries(r).map(([t,e])=>t!=="i"&&e&&e!="0"&&[t,e]).filter(Boolean)),z=r=>Object.fromEntries(Object.keys(r).map(t=>{let e=r[t];return[t,Array.isArray(e)?e.map(s=>s==null?void 0:s.trim()):e===!!e?e:e==null?void 0:e.trim()]})),U=r=>{let[t="",...e]=r.split("|"),[s="",o]=t.split(":"),[a,n]=s.split("?");return{k:a,i:o,n:n==="",f:e}},N=r=>!!(r.o||r.r),$=(r,t)=>{let[e,s]=r.split(":");s||(s=e,e=t);let o=s.split("|"),[a,n,i,l,p,P]=o,m=o.filter(w=>w!==void 0).length;return m===1?{k:e,r:a}:m===2?{k:e,o:a,r:n}:m===3?{k:e,z:a,o:n,r:i}:{k:e,z:a,o:n,t:i,f:l,m:p,r:P}},S=/^\{.*\}$/,E=r=>Object.fromEntries(d(r).split(",").map(t=>t.split(":")).reduce((t,e)=>e.length===2?[...t,e.map(s=>s.trim())]:(t[t.length-1][1]+=","+e[0],t),[])),T=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,d=r=>r.substring(1,r.length-1),C=(r,t=!0,e="",s="")=>r.split(T).map(o=>{if(!o.match(T))return o;let a=d(o);if(a.startsWith("{"))return $(d(a),s);let n=U(a);return s=n.k||s,!e&&(e=s),n}).map(o=>{if(typeof o=="string")return o;o.k||(o.k=e||"0");let a=z(o);return t?O(a):a});var h=r=>r.kind==="text",g=r=>r.kind==="plural",A=r=>r.kind==="parameter";var Z=r=>r.kind==="switch-case",B=r=>X(C(r,!1).map(R).filter(c)),R=r=>f(r)?r?_(r):void 0:N(r)?I(r):W(r),_=r=>({kind:"text",content:r}),I=({k:r,z:t,o:e,t:s,f:o,m:a,r:n})=>({kind:"plural",key:r,...t?{zero:t}:void 0,...e?{one:e}:void 0,...s?{two:s}:void 0,...o?{few:o}:void 0,...a?{many:a}:void 0,other:n}),W=({k:r,i:t,n:e,f:s})=>({kind:"parameter",key:r,types:t?[t]:[],optional:e||!1,transforms:(s||[]).map(G)}),G=r=>r.match(S)?{kind:"switch-case",cases:Object.entries(E(r)).map(([e,s])=>({key:e,value:s})),raw:r}:{kind:"formatter",name:r},X=r=>{let t=r.filter(A),e=r.filter(g),s={};return t.forEach(({key:o,types:a,transforms:n,optional:i})=>{var p,P;let l=a.length?a:q(n);s[o]={types:x([...((p=s[o])==null?void 0:p.types)||[],...l]).filter(c),optional:((P=s[o])==null?void 0:P.optional)||i}}),e.forEach(({key:o})=>{var a;(a=s[o])!=null&&a.types.length||(s[o]={types:["string","number","boolean"],optional:!1})}),Object.keys(s).forEach(o=>{var a,n;(a=s[o])!=null&&a.types.length||(s[o]={types:["unknown"],optional:((n=s[o])==null?void 0:n.optional)||!1})}),Object.entries(s).forEach(([o,a])=>{let n=t.find(i=>i.key===o);!n||(n.types=a.types,n.optional=n.optional||a.optional)}),r};var q=r=>{if(!(r!=null&&r.length))return[];let t=r[0];return Z(t)?t.cases.map(y("key")).map(s=>s==="*"?"string":`'${s}'`):[]};var k=r=>r.map(L).join("");var L=r=>h(r)?r.content:g(r)?H(r):V(r),H=({zero:r,one:t,two:e,few:s,many:o,other:a})=>`{{${[r,t,e,s,o,a].filter(n=>n!==void 0).join("|")}}}`,V=({key:r,optional:t,types:e,transforms:s})=>{let o=e.length===1?e[0]==="unknown"?void 0:e[0]:void 0;return`{${r}${o?`:${o}`:""}${t?"?":""}${s.length?`|${s.map(J).join("|")}`:""}}`},J=r=>r.kind==="formatter"?r.name:r.raw||K(r),K=r=>`{${r.cases.map(({key:t,value:e})=>`${t}:${e}`).join(",")}}`;
